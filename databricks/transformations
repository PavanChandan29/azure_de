# Total Rentable Square Feet by State
total_rentable_sqft_by_state = buildings.groupBy("State").agg(
    F.sum(F.col("Building Rentable Square Feet").cast("float")).alias("Total Rentable Square Feet")
)
total_rentable_sqft_by_state.orderBy(desc("Total Rentable Square Feet")).collect()

# Number of Buildings by Ownership Type
building_count_by_ownership = buildings.groupBy("Owned or Leased").agg(
    F.count("*").alias("Building Count")) 
building_count_by_ownership.show()

# Total Leased Square Feet by Region
total_leased_sqft_by_region = leases.groupBy("GSA Region").agg(
    F.sum(F.col("Building Rentable Square Feet").cast("float")).alias("Total Leased Square Feet")
)
total_leased_sqft_by_region.orderBy(desc("Total Leased Square Feet")).show(5)

# Count of Leases by Expiration Year
leases_by_expiration_year = leases.withColumn(
    "Lease Expiration Year", F.year("Lease Expiration Date")
).groupBy("Lease Expiration Year").agg(
    F.count("*").alias("Lease Count")
)
leases_by_expiration_year.orderBy(desc("Lease Count")).show(5)

# Maximum Lease Duration by Region
lease_duration_by_region = leases.withColumn(
    "Lease Duration", 
    F.datediff(F.col("Lease Expiration Date"), F.col("Lease Effective Date"))
).groupBy("GSA Region").agg(
    F.max("Lease Duration").alias("Max Lease Duration (days)")
)
lease_duration_by_region.orderBy(desc("Max Lease Duration (days)")).show(5)

#Add a column indicating if the lease is active or expired
leases_with_status = leases.withColumn(
    "Lease Status", 
    F.when(F.col("Lease Expiration Date") > F.current_date(), F.lit("Active"))
    .otherwise(F.lit("Expired"))
)
leases_with_status.select("Real Property Asset Name",
    "Building Rentable Square Feet","Lease Number","Lease Status").orderBy(desc("Building Rentable Square Feet")).show(5)
